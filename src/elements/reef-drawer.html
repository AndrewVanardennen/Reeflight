<script>
'use strict';
/**
 * @extends HTMLElement
 */
class ReefDrawer extends HTMLElement {
  /**
   * @param {Object} opts
   * @param {Number} width
   * @param {Boolean} drawerLeft
   */
  constructor(opts={width: 256, drawerLeft: true}) {
    super();
    this._onClick = this._onClick.bind(this);
    this._root = this.attachShadow({mode: 'open'});
    this.width = opts.width;
    this.drawerLeft = opts.drawerLeft;
  }

  /**
   * @return {Boolean}
   */
  get forcedShow() {
    return this.hasAttribute('force-show');
  }

  /**
   * @param {Boolean} value
   */
  set opened(value) {
    this._opened = value;
    if (value) {
      this.setAttribute('opened', '');
    } else {
      this.removeAttribute('opened');
    }
  }

  /**
   * @return {Boolean}
   */
  get opened() {
    return this._opened;
  }

  /**
   * @param {Number} value
   */
  set width(value) {
    if (value === undefined) value = 256;
    this._width = value;
    this.style.setProperty('--reef-drawer-width', `${value}px`);
  }

  /**
   * @return {Number}
   */
  get width() {
    return this._width;
  }

  /**
   * @return {Boolean}
   */
  get drawerRight() {
    return this._drawerRight;
  }

  /**
   * @return {Boolean}
   */
  get drawerLeft() {
    return this._drawerLeft;
  }

  /**
   * @param {Boolean} value
   */
  set drawerLeft(value) {
    if (value) {
      this.classList.add('drawer-left');
      this.drawerRight = false;
    } else {
      this.classList.remove('drawer-left');
      this._drawerLeft = false;
    }
  }

  /**
   * @param {Boolean} value
   */
  set drawerRight(value) {
    if (value) {
      this.classList.add('drawer-right');
      this.drawerLeft = false;
    } else {
      this.classList.remove('drawer-right');
      this._drawerRight = false;
    }
  }

  /**
   * Stamps innerHTML
   */
  connectedCallback() {
    this._root.innerHTML = `
      <style>
        :host {
          user-select: none;
          cursor: default;
          box-shadow: 3px 0 6px -3px rgba(0,0,0,0.21);
          z-index: 100;
          opacity: 0;
          display: flex;
          flex-direction: column;
          position: fixed;
          top: 0;
          bottom:0;
          width: var(--reef-drawer-width, 256px);
          transform: translateX(-102%);
          transition: transform ease-out 0.16s, opacity ease-out 0.16s;
        }
        :host([opened]) {
          opacity: 1;
          transform: translateX(0);
          transition: transform ease-in 0.16s, opacity ease-in 0.16s;
        }
        :host(.drawer-left) {
          left: 0;
        }
        :host(.drawer-right) {
          right: 0;
        }
      </style>
      <slot name="heading"></slot>
      <div style="flex: 1">
        <slot></slot>
      </div>
      <slot name="footer"></slot>
    `;
    this.addEventListener('click', this._onClick);
    if (this.forcedShow) {
      this.opened = true;
    }
  }

  /**
   * stops event propagation
   */
  _onClick() {
    event.stopPropagation();
  }
}
customElements.define('reef-drawer', ReefDrawer);

</script>
