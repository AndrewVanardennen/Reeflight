<script>
/**
 * @extends HTMLElement
 */
class ReefIcon extends HTMLElement {
  /**
   * Attributes to observer
   * @return {Array} ['icon']
   */
  static get observedAttributes() {
    return ['icon'];
  }

  /**
   * Calls super & creates shadowRoot
   */
  constructor() {
    super();
    this.root = this.attachShadow({mode: 'open'});
  }

  /**
   * Stamps innerHTML
   */
  connectedCallback() {
    this.root.innerHTML = `
      <style>
        :host {
          fill: var(--reef-icon-color, #333);
          display: inline-block;
          width: 40px;
          height: 40px;
        }
      </style>
    `;
  }

  /**
   * Runs when attribute changes.
   * @param {string} name The name of the attribute that changed.
   * @param {string|object|array} oldValue
   * @param {string|object|array} newValue
   */
  attributeChangedCallback(name, oldValue, newValue) {
    if (oldValue !== newValue) this[name] = newValue;
  }

  /**
   * Iconset
   * @return {object} window.svgIconSet
   * [checkout](svg-iconset.html) for more info.
   */
  get iconset() {
    return window.svgIconSet;
  }

  /**
   * icon
   * @param {string} value The desired icon.
   * optional: you can create multiple iconsets
   * by setting a different name on svg-iconset.
   *
   * **example:** ```html
   * <svg-iconset name="my-icons">
   *   <g id="menu">....</g>
   * </svg-iconset>
   * ```
   * This means we can ask for the icon using a prefix
   * **example:** ```html
   * <reef-icon-button icon="my-icons::menu"></reef-icon-button>
   * ```
   */
  set icon(value) {
    let parts;
    if (value) {
      parts = value.split('::');
      if (parts.length === 1) {
        this.iconset.icons.host.applyIcon(this, value);
      } else {
        this.iconset[parts[0]].host.applyIcon(this, parts[1]);
      }
      this.setAttribute('icon', value);
    } else {
      parts = this._icon.split('::');
      if (parts.length === 1) {
        this.iconset.icons.host.removeIcon(this);
      } else {
        this.iconset[parts[0]].host.removeIcon(this);
      }
      this.removeAttribute('icon');
    }
    this._icon = value;
  }
}
customElements.define('reef-icon', ReefIcon);
</script>
